<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>
		<report
			id="act_det_report_1"
			model="wolftrak.actividad"
			string="Actividad Detallada por Cliente"
			report_type="qweb-pdf"
			name="wolftrakglobal.wolftrak_act_det_report_1"
			file="wolftrakglobal.wolftrak_act_det_report"
		/>

		<report
			id="act_det_report_2"
			model="wolftrak.actividad"
			string="Actividad Detallada por Fecha"
			report_type="qweb-pdf"
			name="wolftrakglobal.wolftrak_act_det_report_2"
			file="wolftrakglobal.wolftrak_act_det_report"
		/>

		<record id="paperformat_wolftrak" model="report.paperformat">
			<field name="name">Wolftrak custom paper format</field>
			<field name="default" eval="True"/>
			<field name="format">Letter</field>
<!--		<field name="page_height">80</field> -->
<!--		<field name="page_width">175</field> -->
			<field name="orientation">Portrait</field>  <!-- Landscape -->
			<field name="margin_top">3</field>
			<field name="margin_bottom">3</field>
			<field name="margin_left">3</field>
			<field name="margin_right">3</field>
			<field name="header_line" eval="False"/>
<!--		<field name="header_spacing">3</field> -->
		</record>

		<template id="wolftrak_act_det_report_1">
			<t t-foreach="docs" t-as="doc">
				<div class="page" align="center">
					<h3 align="center">Actividad detallada</h3>
					<table>
						<tr>
							<th class="nomina1">Iniciativa</th>
							<th class="nomina1">Responsable</th>
							<th class="nomina1">Fecha de Apertura</th>
							<th class="nomina1">Clasificación</th>
							<th class="nomina1">Duración de la llamada</th>
						</tr>
						<t t-foreach="doc.leads" t-as="lead" style="page-break-inside: avoid">
						<tr class=" tablecolor textcolor">
							<td class="nomina1"><span t-field="lead.name"/></td>
							<td class="nomina1"><span t-field="lead.user_id"/></td>
							<td class="nomina1"><span t-field="lead.date_open"/></td>
							<td class="nomina1" align="right"><span t-field="lead.priority"/></td>
							<td class="nomina1"><span t-field="lead.call_duration"/></td>
						</tr>
							<t t-foreach="doc.mensaje" t-as="msj">
							<t t-if="lead.id == msj.res_id">
						<tr align="center" class="colora textcolor2">
							<t t-if="msj.subtype_id.id != 7">
							<t t-if="msj.subtype_id.id != 2">
							<td class="nomina1" colspan="2" align="center">
								<b><span t-field="msj.body" class="textcolor2"/></b>
							</td>
							</t>
							</t>
							<t t-if="msj.subtype_id.id != 7">
							<t t-if="msj.subtype_id.id != 2">
							<td class="nomina1" colspan="2" align="center">
								<span t-field="msj.date"/>
							</td>
							</t>
							</t>
						</tr>
							</t>
							</t>
						</t>
					</table>
				</div>
			</t>
		</template>

	<template id="wolftrak_act_det_report_2">
		<t t-foreach="docs" t-as="doc">
			<div class="page" align="center">
				<t t-set="desde" t-value="int(doc.desde[8:12])"/> <!-- toma el DIA de inicio -->
				<t t-set="hasta" t-value="int(doc.hasta[8:12])"/> <!-- toma el DIA de final -->
				<t t-set="range_1" t-value="range(desde,hasta+1)"/> <!-- cuenta cuandos dias entre las fechas -->
				<h3 align="center">Actividad detallada</h3>
				<br/>
				<table>
					<t t-foreach="range_1" t-as="ran" style="page-break-inside: avoid">
						<t t-set="fecha" t-value="doc.hasta[:8]+str(ran)"/> 
						<tr class="textcolor tablecolor">
							<th class="nomina1" align="right">Fecha</th>
							<th class="nomina1"><span t-esc="fecha"/></th>
						</tr>
						<tr class="textcolor tablecolor">
							<th class="nomina1">Responsable</th>
							<th class="nomina1">Siguiente Actividad</th>
							<th class="nomina1">Estado</th>
							<th class="nomina1">Actividad</th>
						</tr>
						<t t-foreach="doc.mensaje.sorted(key=lambda t: t.date)" t-as="msj">
							<t t-if="ran == int(msj.write_date[8:11])">
								<t t-if="msj.subtype_id.id != 2">
									<t t-foreach="doc.leads" t-as="lead" style="page-break-inside: avoid">
										<t t-if="msj.res_id == lead.id">
											<tr class="textcolor tablecolor">
												<td colspan="4"><span t-field="lead.name"/></td>
											</tr>
										</t>
									</t>
									<tr>
										<t t-foreach="doc.leads" t-as="lead" style="page-break-inside: avoid">
											<t t-if="msj.res_id == lead.id">
												<td class="nomina1"><span t-field="lead.user_id"/></td>
												<td class="nomina1"><span t-field="lead.next_activity_id"/></td>
												<td class="nomina1"><span t-field="lead.stage_id"/></td>
											</t>
										</t>
										<t t-if="msj.subtype_id.id == 7">
											<td colspan="5" class="nomina1">Cambio de estado</td>
										</t>
										<t t-if="msj.subtype_id.id == 8">
											<td colspan="5" class="nomina1">No interesado</td>
										</t>
										<t t-if="msj.subtype_id.id != 7">
											<td colspan="5" class="nomina1"><span t-field="msj.body"/></td>
										</t>
									</tr>
								</t>
							</t>
						</t>
					</t>
				</table>
			</div>
		</t>
	</template>

	</data>
</openerp>